{% load static %}
{% load compress %}
{% load meta %}

<!DOCTYPE html>
<html lang="en">
    <head>
        <meta charset="UTF-8">
        <meta name="viewport" content="width=device-width, initial-scale=1.0">
        <title>CareerConnect | Manage Your Job Postings</title>
        <link rel="stylesheet" href="{% static 'css/flowbite.min.css' %}">
        <script src = "{% static 'js/flowbite.min.js' %}" type = "text/javascript"></script>
    </head>
    <body>
        <!-- Trigger button -->
<button
  type="button"
  data-modal-target="qrModal"
  data-modal-toggle="qrModal"
  class="inline-flex items-center gap-2 rounded-xl border px-4 py-2 text-sm font-medium hover:bg-gray-50"
  aria-controls="qrModal"
>
  <!-- optional icon -->
  <svg xmlns="http://www.w3.org/2000/svg" class="h-4 w-4" fill="none" viewBox="0 0 24 24" stroke="currentColor">
    <path stroke-linecap="round" stroke-linejoin="round" stroke-width="1.5"
          d="M3 3h4v4H3V3zm14 0h4v4h-4V3zM3 17h4v4H3v-4zm14 0h4v4h-4v-4zM9 3h6v2H9V3zm0 16h6v2H9v-2zM3 9h2v6H3V9zm16 0h2v6h-2V9z"/>
  </svg>
  View QR Code
</button>

<!-- Modal -->
<div id="qrModal" tabindex="-1" aria-hidden="true"
     class="fixed inset-0 z-50 hidden overflow-y-auto overflow-x-hidden">
  <!-- backdrop -->
  <div class="fixed inset-0 bg-black/40"></div>

  <div class="relative mx-auto my-8 w-full max-w-md p-4">
    <div class="relative rounded-2xl bg-white shadow-xl">
      <!-- Header -->
      <div class="flex items-center justify-between border-b px-5 py-4">
        <h3 class="text-base font-semibold">
          Your Profile QR Code
        </h3>
        <button type="button" class="rounded-lg p-2 text-gray-500 hover:bg-gray-100"
                data-modal-hide="qrModal" aria-label="Close">
          <svg class="h-5 w-5" viewBox="0 0 20 20" fill="currentColor" aria-hidden="true">
            <path fill-rule="evenodd"
                  d="M4.293 4.293a1 1 0 011.414 0L10 8.586l4.293-4.293a1 1 0 111.414 1.414L11.414 10l4.293 4.293a1 1 0 01-1.414 1.414L10 11.414l-4.293 4.293a1 1 0 01-1.414-1.414L8.586 10 4.293 5.707a1 1 0 010-1.414z"
                  clip-rule="evenodd"/>
          </svg>
        </button>
      </div>

      <!-- Body -->
      <div class="space-y-4 px-5 py-5">
        <p class="text-sm text-gray-500">Scan to view/share this candidateâ€™s profile.</p>

        <!-- QR image -->
        <div class="flex justify-center">
          <img
            src="{{ candidate.qr_code.url }}"
            alt="QR Code for {{ candidate.name }}"
            class="h-40 w-40 rounded-lg border"
            id="qrImage"
            loading="lazy"
          />
        </div>

        <!-- Profile link with copy -->
        <!-- If you have `request` in the template context -->
        <div class="flex items-stretch gap-2">
          <input
            type="text"
            readonly
            class="w-full rounded-xl border px-3 py-2 text-sm"
            value="qr code"
            id="profileLinkInput"
          />
          <button type="button"
                  class="shrink-0 rounded-xl border px-3 py-2 text-sm hover:bg-gray-50"
                  onclick="copyProfileLink()">
            Copy
          </button>
        </div>

        <!-- If you don't have `request` available, you can use:
             value="{{ SITE_URL }}{{ candidate.get_absolute_url }}" -->
      </div>

      <!-- Footer -->
      <div class="flex flex-wrap items-center justify-between gap-3 border-t px-5 py-4">
        <a href="{{ candidate.qr_code.url }}" download
           class="rounded-xl border px-4 py-2 text-sm hover:bg-gray-50">
          Download QR
        </a>
        <div class="flex items-center gap-2">
          <button type="button"
                  class="rounded-xl border px-4 py-2 text-sm hover:bg-gray-50"
                  onclick="copyProfileLink()">
            Copy Link
          </button>
          <button type="button"
                  class="rounded-xl border px-4 py-2 text-sm hover:bg-gray-50"
                  onclick="printQrImage('{{ candidate.qr_code.url }}')">
            Print
          </button>
          <button type="button"
                  class="rounded-xl bg-gray-900 px-4 py-2 text-sm text-white hover:bg-black"
                  data-modal-hide="qrModal">
            Close
          </button>
        </div>
      </div>
    </div>
  </div>
</div>

<script>
  async function copyProfileLink() {
    const input = document.getElementById('profileLinkInput');
    try {
      await navigator.clipboard.writeText(input.value);
      // optional: give quick feedback
      const original = input.value;
      input.value = 'Link copied!';
      setTimeout(() => { input.value = original; }, 900);
    } catch (e) {
      // fallback
      input.select();
      document.execCommand('copy');
    }
  }

  function printQrImage(url) {
    // open a minimal window with just the image for clean printing
    const w = window.open('', '_blank', 'width=400,height=480');
    w.document.write(`
      <html>
        <head>
          <title>Print QR</title>
          <style>
            body { margin: 0; display: grid; place-items: center; height: 100vh; }
            img { width: 320px; height: 320px; }
          </style>
        </head>
        <body>
          <img src="${url}" alt="QR Code" onload="window.print(); window.onafterprint = () => window.close();">
        </body>
      </html>
    `);
    w.document.close();
  }
</script>


    </body>
</html>